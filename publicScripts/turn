#!/usr/local/bin/nodejs

let net = require('net')
const conf = require('../config/myhome.json')

const serverAddress = conf.host
const serverPort = conf.port

const myhome = {"on": 1, "off": 0}


console.log(serverAddress + ":" + serverPort)

if (process.argv.length != 5) {
  console.log("Wrong command")
} else {
  let action = process.argv[2]
  let ambient = process.argv[3]
  let pl = process.argv[4]
  console.log("action: " + action)
  console.log("ambient: " + ambient)
  console.log("pl: " + pl)
  let command = "*1*" + myhome[action] + "*" + conf.ambients[ambient].amb + conf.ambients[ambient].pl[pl] + "##"
  console.log("command string: " + command)
  send(command)
}

// print process.argv
process.argv.forEach(function (val, index, array) {
  console.log(index + ': ' + val);
});

function send(message) {
  sendMessage(serverAddress, serverPort, message)
}

function sendMessage(host, port, message) {
  const socket = new net.Socket()
  let responses = []

  // Send message after connection
  socket.connect({port, host}, () => {
      socket.end(message)
  })
}

// send('*1*1*13##')
// send('*1*0*13##')
// send('*1*1*13##')
// send('*1*0*13##')
// send('*1*1*13##')
// send('*1*0*13##')